!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SVGDCore={})}(this,(function(t){"use strict";var e=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t){function e(){return t.exports=e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},e.apply(this,arguments)}t.exports=e})),n=function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},i=function(t,e){return void 0===e&&(e=2),+t.toFixed(e)},r=function(t){return t.replace(/-([a-z])/g,(function(t,e){return e.toUpperCase()}))},s=function(t,e){return Math.trunc(t)===Math.trunc(e)},a=function(t){return t!=t},o="http://www.w3.org/2000/svg",h=function(t,e){var n=document.createElementNS(o,"svg");return n.setAttributeNS(null,"version","1.1"),n.setAttribute("xmlns",o),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),Object.keys(t).sort().map((function(e){n.setAttribute(e,t[e])})),e.map((function(t){n.appendChild(t)})),n},u=function(t,e){var n=document.createElementNS(o,t);return Object.keys(e).sort().map((function(t){n.setAttribute(t,e[t])})),n},l=function(t){var i=Object.entries(t).reduce((function(t,i,r){var s,a=i[0],o=i[1];return o?e({},t,((s={})[n(a)]=o,s)):t}),{});return u("path",i)},c=function(t){var n=t.width,i=t.height,r=t.background,s=t.paths,a={width:String(n),height:String(i)},o=r?[u("rect",e({},a,{fill:r}))]:[];return h(a,[].concat(o,s.map(l)))},d=function(){function t(t,e){var n=(void 0===e?{}:e).background;this.el=t;var i=t.getBoundingClientRect(),r=i.width,s=i.height;t.appendChild(c({background:n,width:r,height:s,paths:[]}))}return t.prototype.update=function(t){this.el.replaceChild(c(t),this.el.childNodes[0])},t}();var v=function(t,e){if(null==t)return{};var n,i,r={},s=Object.keys(t);for(i=0;i<s.length;i++)n=s[i],e.indexOf(n)>=0||(r[n]=t[n]);return r};function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var f=function(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),t},m=function(){function t(t,e){this.x=t,this.y=e}var e=t.prototype;return e.toVector=function(){var t=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)),e=Math.atan2(this.y,this.x);return new _(t,e)},e.scale=function(e){return new t(this.x*e,this.y*e)},e.add=function(e){return new t(this.x+e.x,this.y+e.y)},e.sub=function(e){return new t(this.x-e.x,this.y-e.y)},e.eql=function(t){return this.x===t.x&&this.y===t.y},e.clone=function(){return new t(this.x,this.y)},t}(),w={MOVE:"M",MOVE_RELATIVE:"m",LINE:"L",LINE_RELATIVE:"l",CURVE:"C",CURVE_RELATIVE:"c",CLOSE:"Z",HORIZONTAL:"H",HORIZONTAL_RELATIVE:"h",VERTICAL:"V",VERTICAL_RELATIVE:"v",ARC_CURVE:"A",ARC_CURVE_RELATIVE:"a",QUADRATIC_CURVE:"Q",QUADRATIC_CURVE_RELATIVE:"q"},g=function(){function t(t,e){void 0===e&&(e=[]),this.value=e,this.type=t}var e=t.prototype;return e.toString=function(){return this.type===w.CLOSE?w.CLOSE:this.type+" "+this.value.map((function(t){return i(t)})).join(" ")},e.scale=function(e){return new t(this.type,this.value.map((function(t){return t*e})))},e.clone=function(){return new t(this.type,this.value.slice())},f(t,[{key:"cr",set:function(t){t&&("C"!==this.type&&"c"!==this.type||6!==this.value.length||(this.value.splice(2,1,t.x),this.value.splice(3,1,t.y)))},get:function(){if(("C"===this.type||"c"===this.type)&&6===this.value.length){var t=this.value.slice(2,4),e=t[0],n=t[1];return new m(e,n)}}},{key:"cl",set:function(t){t&&("C"!==this.type&&"c"!==this.type||6!==this.value.length||(this.value.splice(0,1,t.x),this.value.splice(1,1,t.y)))},get:function(){if(("C"===this.type||"c"===this.type)&&6===this.value.length){var t=this.value.slice(0,2),e=t[0],n=t[1];return new m(e,n)}}},{key:"point",set:function(t){t&&(this.value.splice(this.value.length-2,1,t.x),this.value.splice(this.value.length-1,1,t.y))},get:function(){var t=this.value.slice(this.value.length-2);return 2===t.length?new m(t[0],t[1]):void 0}}]),t}(),_=function(){function t(t,e){this.value=t,this.angle=e}var e=t.prototype;return e.toPoint=function(){var t=Math.cos(this.angle)*this.value,e=Math.sin(this.angle)*this.value;return new m(t,e)},e.scale=function(e){return new t(this.value*e,this.angle)},t}(),y=function(){function t(t){var e=void 0===t?{}:t,n=e.d,i=v(e,["d"]);this.attrs=i,this.commands=[],n&&this.parseCommandString(n)}var n=t.prototype;return n.scale=function(t){return this.commands=this.commands.map((function(e){return e.scale(t)})),this.attrs.strokeWidth=String(t*+(this.attrs.strokeWidth||0)),this},n.addCommand=function(t){var e;Array.isArray(t)?(e=this.commands).push.apply(e,t):this.commands.push(t);return this},n.getCommandString=function(){return 0===this.commands.length?"":this.commands.map((function(t,e){return t.toString()})).join(" ").trim()},n.parseCommandString=function(t){this.commands=[];for(var e=null,n=[],i=t.split(" "),r=function(t){return Object.values(w).includes(t)?t:null},s=0;s<i.length;s+=1){var o=r(i[s]);if(o){if(!e){e=o;continue}this.commands.push(new g(e,n)),e=o,n=[]}else{if(a(+i[s]))return;n.push(+i[s])}}null!==e&&this.commands.push(new g(e,n))},n.parsePathElement=function(t){for(var n=0;n<t.attributes.length;n+=1){var i,s=t.attributes.item(n);s&&s.value&&("d"!==s.name?this.attrs=e({},this.attrs,((i={})[r(s.name)]=s.value,i)):this.parseCommandString(s.value))}return this},n.toJson=function(){return e({},this.attrs,{d:this.getCommandString()})},n.clone=function(){var e=new t(this.attrs);return this.commands.map((function(t){e.commands.push(t.clone())})),e},t}(),E=function(){function t(t){var e=t.width,n=t.height,i=t.background;this.paths=[],this.width=e,this.height=n,this.background=i}var e=t.prototype;return e.resize=function(t){var e=t.width,n=t.height;this.scalePath(e/this.width),this.width=e,this.height=n},e.scalePath=function(t){if(1!==t)for(var e=0;e<this.paths.length;e+=1)this.paths[e].scale(t);return this},e.addPath=function(t){var e;Array.isArray(t)?(e=this.paths).push.apply(e,t):this.paths.push(t);return this},e.clonePaths=function(){return this.paths.map((function(t){return t.clone()}))},e.updatePath=function(t,e){var n=e||this.paths.length-1;return n<0&&this.paths.push(t),this.paths[n]=t,this},e.toJson=function(){return{width:this.width,height:this.height,background:this.background,paths:this.paths.map((function(t){return t.toJson()}))}},e.copy=function(t){return this.paths=t.clonePaths(),t.width&&this.width&&this.scalePath(this.width/t.width),this},e.parseSVGString=function(t){var e=(new DOMParser).parseFromString(t,"image/svg+xml").querySelector("svg");return e?this.parseSVGElement(e):(this.paths=[],this)},e.parseSVGElement=function(t){var e=[];t.querySelectorAll("path").forEach((function(t){var n=(new y).parsePathElement(t);0!==n.commands.length&&e.push(n)})),this.paths=e;var n=Number(t.getAttribute("width"));return n&&this.width&&this.scalePath(this.width/n),this},t}(),b=function(){function t(t){var e=(void 0===t?{}:t).ratio;this.ratio=null!=e?e:.2}var e=t.prototype;return e._controlPoint=function(t,e,n){var i=new m(t.x,t.y),r=new m(e.x,e.y),s=new m(n.x,n.y).sub(i).toVector().scale(this.ratio).toPoint(),a=r.add(s);return[a.x,a.y]},e.bezierCurve=function(t,e,n,i){var r=[].concat(this._controlPoint(t,e,n),this._controlPoint(i,n,e),[n.x,n.y]);return new g(w.CURVE,r)},e.lineCommands=function(t){return t.map((function(t,e){return new g(0===e?w.MOVE:w.LINE,[t.x,t.y])}))},e.bezierCurveCommands=function(t){var e=[];if(t.length<3)return this.lineCommands(t);for(var n=0;n<t.length;n+=1)0!==n?e.push(this.bezierCurve(t[n-2<0?0:n-2],t[n-1],t[n],n<t.length-1?t[n+1]:t[n])):e.push(new g(w.MOVE,[t[n].x,t[n].y]));return e},t}();function C(t,e,n){var i,r,s;void 0===n&&(n={});var a=null,o=0,h=function(){o=!1===n.leading?0:Date.now(),a=null,s=t.apply(i,r),a||(i=null,r=null)},u=function(){a&&(clearTimeout(a),a=null)};return function(){var l=Date.now();o||!1!==n.leading||(o=l);var c=e-(l-o);i=this;for(var d=arguments.length,v=new Array(d),p=0;p<d;p++)v[p]=arguments[p];return r=v,c<=0||c>e?(u(),o=l,s=t.apply(i,r),a||(i=null,r=null)):a||!1===n.trailing||(a=setTimeout(h,c)),s}}var L=function(t){void 0===t&&(t=!0);try{var e=function(){return null};return addEventListener("testPassive",e,{passive:t}),removeEventListener("testPassive",e),{passive:t}}catch(t){return!1}},P={pointer:{start:["pointerdown"],move:["pointermove"],end:["pointerleave","pointercancel"],frameout:["pointerup"]},touch:{start:["touchstart"],move:["touchmove"],end:["touchend"],frameout:["touchcancel"]},mouse:{start:["mousedown"],move:["mousemove"],end:["mouseleave","mouseout"],frameout:["mouseup"]}},x=function(){function t(t,e){var n=e.end,i=e.start,r=e.move;this._el=t,this.end=n,this.start=i,this.move=r,this._clearEventList=[],this._listenerOption=L(!1);var s=t.getBoundingClientRect(),a=s.left,o=s.top;this._left=a,this._top=o,this._handleStart=this._handleStart.bind(this),this._handleMove=this._handleMove.bind(this),this._handleEnd=this._handleEnd.bind(this)}var e=t.prototype;return e.off=function(){this._clearEventList.map((function(t){return t()})),this._clearEventList=[]},e.on=function(){this.off(),this._setupCoordinatesListener(),window.PointerEvent?this._setupDrawListener("pointer"):this._setupDrawListener("mouse"),"ontouchstart"in window&&this._setupDrawListener("touch")},e._handleStart=function(t){t.preventDefault(),this.start()},e._handleEnd=function(t){t.preventDefault(),this.end()},e._handleMove=function(t){if(t.preventDefault(),t instanceof TouchEvent){var e=t.touches[0];this.move({x:e.clientX-this._left,y:e.clientY-this._top,pressure:e.force})}else t instanceof PointerEvent?this.move({x:t.clientX-this._left,y:t.clientY-this._top,pressure:t.pressure}):t instanceof MouseEvent&&this.move({x:t.clientX-this._left,y:t.clientY-this._top,pressure:null==t?void 0:t.pressure})},e._setupDrawListener=function(t){var e,n=this,i=P[t],r=i.start,s=i.move,a=i.end,o=i.frameout,h=r.map((function(t){return n._el.addEventListener(t,n._handleStart,n._listenerOption),function(){return n._el.removeEventListener(t,n._handleStart)}})),u=s.map((function(t){return n._el.addEventListener(t,n._handleMove,n._listenerOption),function(){return n._el.removeEventListener(t,n._handleMove)}})),l=a.map((function(t){return n._el.addEventListener(t,n._handleEnd,n._listenerOption),function(){return n._el.removeEventListener(t,n._handleEnd)}})),c=o.map((function(t){return addEventListener(t,n._handleEnd,n._listenerOption),function(){return removeEventListener(t,n._handleEnd)}}));(e=this._clearEventList).push.apply(e,h.concat(u,l,c))},e._setupCoordinatesListener=function(){var t=this,e=function(e){var n=t._el.getBoundingClientRect(),i=n.left,r=n.top;t._left=i,t._top=r};addEventListener("scroll",e),this._el.addEventListener("resize",e),this._clearEventList.push((function(){removeEventListener("scroll",e),t._el.removeEventListener("resize",e)}))},t}(),S=function(){function t(t,e){var n=e.resize;this._el=t,this.resize=n,this._clearEventList=[]}var e=t.prototype;return e.off=function(){this._clearEventList.map((function(t){return t()})),this._clearEventList=[]},e.on=function(){this.off(),this._setupListerner()},e._setupListerner=function(){var t=this;if(window.ResizeObserver){var e=new window.ResizeObserver((function(e){var n=e[0];t.resize(n.contentRect)}));e.observe(this._el),this._clearEventList.push((function(){return e.disconnect()}))}else{var n=function(){t.resize(t._el.getBoundingClientRect())};addEventListener("resize",n),this._clearEventList.push((function(){return removeEventListener("resize",n)}))}},t}(),R=function(t){return A(c(t).outerHTML)},A=function(t){return"data:image/svg+xml;base64,"+btoa(t)},O={png:"image/png",jpg:"image/jpeg",svg:"image/svg+xml"},k=function(t){for(var e=t.data,n=t.extension,i=t.filename,r=atob(e.replace(/^.*,/,"")),s=new Uint8Array(r.length),a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);var o=i||Date.now()+"."+n,h=new Blob([s.buffer],{type:O[n]});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(h,o);else if(window.URL&&window.URL.createObjectURL){var u=document.createElement("a");u.download=o,u.href=window.URL.createObjectURL(h),document.body.appendChild(u),u.click(),document.body.removeChild(u)}else window.open(e,"_blank")},M={extension:"svg"},z=function(t,n,i){void 0===n&&(n=M),void 0===i&&(i=k);var r=e({},M,n),s=r.filename,a=r.extension,o=R(t.toJson());if("svg"!==a){var h=t.width,u=t.height,l=t.background,c=new Image;c.addEventListener("load",(function(){var t=document.createElement("canvas");t.setAttribute("width",String(h)),t.setAttribute("height",String(u));var e=t.getContext("2d");e&&((l||"jpg"===a)&&(e.fillStyle=l||"#fff",e.fillRect(0,0,h,u)),e.drawImage(c,0,0),i("png"===a?{data:t.toDataURL("image/png"),extension:"png"}:{data:t.toDataURL("image/jpeg"),extension:"jpg"}))}),!1),c.src=o}else i({data:o,extension:"svg",filename:s})},V=function(){function t(t,e){var n=void 0===e?{}:e,i=n.penColor,r=n.penWidth,s=n.curve,a=n.close,o=n.delay,h=n.fill,u=n.background;this.el=t,this.penColor=null!=i?i:"#000",this.penWidth=null!=r?r:1,this.curve=null==s||s,this.close=null!=a&&a,this.delay=null!=o?o:0,this.fill=null!=h?h:"none";var l=t.getBoundingClientRect(),c=l.width,v=l.height;this._drawPath=null,this._drawPoints=[],this.svg=new E({width:c,height:v,background:u}),this.renderer=new d(t,{background:u}),this.convert=new b,this._resize=this._resize.bind(this),this.resizeHandler=new S(t,{resize:this._resize}),this.drawStart=this.drawStart.bind(this),this.drawMove=this.drawMove.bind(this),this._drawMoveThrottle=C(this.drawMove,this.delay),this.drawEnd=this.drawEnd.bind(this),this.drawHandler=new x(t,{start:this.drawStart,move:this._drawMoveThrottle,end:this.drawEnd}),this.on()}var e=t.prototype;return e.update=function(){this.renderer.update(this.svg.toJson())},e.clear=function(){var t=this.svg.paths;return this.svg.paths=[],this.update(),t},e.undo=function(){var t=this.svg.paths.pop();return this.update(),t},e.changeDelay=function(t){this.delay=t,this.drawHandler.move=C(this.drawMove,this.delay),this.drawHandler.on()},e.on=function(){this.drawHandler.on(),this.resizeHandler.on()},e.off=function(){this.drawHandler.off(),this.resizeHandler.off()},e.drawStart=function(){this._drawPath||(this._drawPath=this._createDrawPath(),this.svg.addPath(this._drawPath))},e.drawMove=function(t){this._drawPath&&(this._addDrawPoint(t),(this._drawPath.attrs.strokeWidth&&+this._drawPath.attrs.strokeWidth!==this.penWidth||this._drawPath.attrs.stroke!==this.penColor)&&(this._drawPath=this._createDrawPath(),this._addDrawPoint(t),this.svg.addPath(this._drawPath)),this.update())},e.drawEnd=function(){this._drawPath=null,this.update()},e._createCommand=function(){this._drawPath&&(this.curve?this._drawPath.commands=this.convert.bezierCurveCommands(this._drawPoints):this._drawPath.commands=this.convert.lineCommands(this._drawPoints),this.close&&this._drawPath.commands.push(new g(w.CLOSE)))},e._addDrawPoint=function(t){this._drawPoints.push(t),this._createCommand()},e._createDrawPath=function(){return this._resize(this.el.getBoundingClientRect()),this._drawPoints=[],new y({stroke:this.penColor,strokeWidth:String(this.penWidth),fill:this.fill,strokeLinecap:this.curve?"round":"mitter",strokeLinejoin:this.curve?"round":"square"})},e._resize=function(t){var e=t.width,n=t.height;s(this.svg.width,e)||(this.svg.resize({width:e,height:n}),this.update())},e.download=function(t){z(this.svg,t)},t}();t.COMMAND_TYPE=w,t.Command=g,t.Convert=b,t.DrawHandler=x,t.Path=y,t.Point=m,t.Renderer=d,t.ResizeHandler=S,t.Svg=E,t.SvgDrawing=V,t.Vector=_,t.camel2kebab=n,t.createSvgChildElement=u,t.createSvgElement=h,t.download=z,t.downloadBlob=k,t.getPassiveOptions=L,t.isAlmostSameNumber=s,t.isNaN=a,t.kebab2camel=r,t.mimeTypeMap=O,t.pathObjectToElement=l,t.roundUp=i,t.svg2base64=A,t.svgObjectToElement=c,t.throttle=C,t.toBase64=R,Object.defineProperty(t,"__esModule",{value:!0})}));
